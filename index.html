<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LLM Time Analysis (Client-side)</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <h1>LLM Time Analysis</h1>
    <p>Compute LLM-only runtimes from time.json files or Societas share URLs entirely in the browser.</p>
  </header>

  <section class="controls">
    <div class="control-row">
      <label for="tz-select">Display timezone:</label>
      <select id="tz-select">
        <option value="UTC">UTC</option>
        <option value="Asia/Shanghai" selected>UTC+8 (Asia/Shanghai)</option>
        <option value="America/Los_Angeles">America/Los_Angeles</option>
        <option value="America/New_York">America/New_York</option>
        <option value="Europe/London">Europe/London</option>
      </select>
      <button id="btn-clear">Clear Results</button>
    </div>

    <div class="control-row">
      <label for="file-input" class="btn">Choose time.json</label>
      <input id="file-input" type="file" accept="application/json,.json" />
      <span class="hint">or drag & drop the file anywhere on this page</span>
    </div>

    <details>
      <summary>Paste JSON</summary>
      <textarea id="json-text" placeholder="Paste raw JSON content here..."></textarea>
      <div class="control-row">
        <button id="btn-parse-text">Parse Pasted JSON</button>
      </div>
    </details>

    <details>
      <summary>Paste URL âœ¨ (New! Auto-fetch from Societas URLs)</summary>
      <div class="control-row">
        <input id="url-input" type="url" placeholder="Paste URL here (e.g., https://staging.societas.ms/share/...)" />
        <button id="btn-fetch-url">Fetch & Parse from URL</button>
      </div>
      <div class="hint">âœ… Automatically extracts thread ID and fetches data using corsproxy.io proxy</div>
      <div id="url-status" class="status-message"></div>
    </details>
  </section>

  <section id="summary" class="card hidden">
    <h2>Summary</h2>
    <div class="summary-grid">
      <div>
        <div class="label">First message</div>
        <div id="first-msg" class="value">-</div>
      </div>
      <div>
        <div class="label">Last message</div>
        <div id="last-msg" class="value">-</div>
      </div>
      <div>
        <div class="label">Run-sum LLM runtime</div>
        <div id="run-total" class="value">-</div>
      </div>
      <div>
        <div class="label">Cycle-sum LLM runtime</div>
        <div id="cycle-total" class="value">-</div>
      </div>
    </div>
  </section>

  <section id="runs" class="card hidden">
    <div class="card-head">
      <h2>LLM Run Windows (assistant â†’ own tools)</h2>
      <button id="export-runs">Export CSV</button>
    </div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Run ID</th>
            <th>Assistant Message ID</th>
            <th>Start</th>
            <th>End</th>
            <th>Duration (s)</th>
          </tr>
        </thead>
        <tbody id="runs-tbody"></tbody>
      </table>
    </div>
  </section>

  <section id="cycles" class="card hidden">
    <div class="card-head">
      <h2>LLM Active Cycles (user-triggered â†’ last non-user before next user)</h2>
      <button id="export-cycles">Export CSV</button>
    </div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Trigger User Message ID</th>
            <th>Start</th>
            <th>End</th>
            <th>Duration (s)</th>
          </tr>
        </thead>
        <tbody id="cycles-tbody"></tbody>
      </table>
    </div>
  </section>

  <footer>
    <p>All parsing is done locally in your browser. No data leaves your device.</p>
    <div style="margin: 15px 0; padding: 15px; background: #e3f2fd; border-radius: 8px;">
      <p style="margin: 0 0 10px; font-weight: bold; color: #1976d2;">ğŸ†• æ–°åŠŸèƒ½ï¼šAIå¯¹è¯åˆ†æå·¥å…·</p>
      <div style="display: flex; gap: 20px; flex-wrap: wrap;">
        <p style="margin: 0;">
          <a href="conversation-view.html" style="color: #1976d2; text-decoration: none; font-weight: 600;">
            ğŸ“± å•ä¸ªå¯¹è¯å¯è§†åŒ– â†’
          </a>
          <span style="color: #666; margin-left: 10px;">è¯¦ç»†å±•ç¤ºå•ä¸ªå¯¹è¯çš„å†…å®¹å’Œæ—¶é—´</span>
        </p>
        <p style="margin: 0;">
          <a href="batch-analysis.html" style="color: #1976d2; text-decoration: none; font-weight: 600;">
            ğŸš€ æ‰¹é‡å¯¹è¯åˆ†æ â†’
          </a>
          <span style="color: #666; margin-left: 10px;">ä¸€æ¬¡æ€§åˆ†æå¤šä¸ªå¯¹è¯ï¼Œå¿«é€Ÿæ¦‚è§ˆ</span>
        </p>
      </div>
    </div>
    <p>
      <a href="https://pages.github.com/" target="_blank" rel="noopener">Deploy to GitHub Pages</a>
    </p>
  </footer>

  <script src="app.js"></script>
</body>
</html> 